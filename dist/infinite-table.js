!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Vue")):"function"==typeof define&&define.amd?define(["Vue"],t):"object"==typeof exports?exports.InfiniteTable=t(require("Vue")):e.InfiniteTable=t(e.Vue)}(window,function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(t,n){t.exports=e},function(e,t,n){},function(e,t,n){},function(e,t,n){
/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */
const i=n(8);function r(e,t,n){return"function"==typeof n.join?n.join(e):e[0]+t+e[1]}function o(e,t,n){return"function"!=typeof n.isValid||n.isValid(e,t)}function a(e){return i(e)||Array.isArray(e)||"function"==typeof e}e.exports=function(e,t,n){if(i(n)||(n={default:n}),!a(e))return void 0!==n.default?n.default:e;"number"==typeof t&&(t=String(t));const s=Array.isArray(t),l="string"==typeof t,u=n.separator||".",c=n.joinChar||("string"==typeof u?u:".");if(!l&&!s)return e;if(l&&t in e)return o(t,e,n)?e[t]:n.default;let d=s?t:function(e,t,n){if("function"==typeof n.split)return n.split(e);return e.split(t)}(t,u,n),f=d.length,h=0;do{let t=d[h];for("number"==typeof t&&(t=String(t));t&&"\\"===t.slice(-1);)t=r([t.slice(0,-1),d[++h]||""],c,n);if(t in e){if(!o(t,e,n))return n.default;e=e[t]}else{let i=!1,a=h+1;for(;a<f;)if(i=(t=r([t,d[a++]],c,n))in e){if(!o(t,e,n))return n.default;e=e[t],h=a-1;break}if(!i)return n.default}}while(++h<f&&a(e));return h===f?e:n.default}},function(e,t,n){"use strict";(function(e){var n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some(function(e,i){return e[0]===t&&(n=i,!0)}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var r=i[n];e.call(t,r[1],r[0])}},t}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r=void 0!==e&&e.Math===Math?e:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),o="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)},a=2;var s=20,l=["top","right","bottom","left","width","height","size","weight"],u="undefined"!=typeof MutationObserver,c=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,r=0;function s(){n&&(n=!1,e()),i&&u()}function l(){o(s)}function u(){var e=Date.now();if(n){if(e-r<a)return;i=!0}else n=!0,i=!1,setTimeout(l,t);r=e}return u}(this.refresh.bind(this),s)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return e.forEach(function(e){return e.broadcastActive()}),e.length>0},e.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),u?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;l.some(function(e){return!!~n.indexOf(e)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),d=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},f=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||r},h=g(0,0,0,0);function p(e){return parseFloat(e)||0}function b(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(t,n){return t+p(e["border-"+n+"-width"])},0)}function v(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return h;var i=f(e).getComputedStyle(e),r=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var r=i[n],o=e["padding-"+r];t[r]=p(o)}return t}(i),o=r.left+r.right,a=r.top+r.bottom,s=p(i.width),l=p(i.height);if("border-box"===i.boxSizing&&(Math.round(s+o)!==t&&(s-=b(i,"left","right")+o),Math.round(l+a)!==n&&(l-=b(i,"top","bottom")+a)),!function(e){return e===f(e).document.documentElement}(e)){var u=Math.round(s+o)-t,c=Math.round(l+a)-n;1!==Math.abs(u)&&(s-=u),1!==Math.abs(c)&&(l-=c)}return g(r.left,r.top,s,l)}var m="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof f(e).SVGGraphicsElement}:function(e){return e instanceof f(e).SVGElement&&"function"==typeof e.getBBox};function y(e){return i?m(e)?function(e){var t=e.getBBox();return g(0,0,t.width,t.height)}(e):v(e):h}function g(e,t,n,i){return{x:e,y:t,width:n,height:i}}var w=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=y(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),x=function(e,t){var n,i,r,o,a,s,l,u=(i=(n=t).x,r=n.y,o=n.width,a=n.height,s="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(s.prototype),d(l,{x:i,y:r,width:o,height:a,top:r,right:i+o,bottom:a+r,left:i}),l);d(this,{target:e,contentRect:u})},_=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof f(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new w(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof f(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(e){return new x(e.target,e.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),O="undefined"!=typeof WeakMap?new WeakMap:new n,C=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=c.getInstance(),i=new _(t,n,this);O.set(this,i)};["observe","unobserve","disconnect"].forEach(function(e){C.prototype[e]=function(){var t;return(t=O.get(this))[e].apply(t,arguments)}});var S=void 0!==r.ResizeObserver?r.ResizeObserver:C;t.a=S}).call(this,n(9))},function(e,t){function n(e,t,n){var i,r,o,a,s;function l(){var u=Date.now()-a;u<t&&u>=0?i=setTimeout(l,t-u):(i=null,n||(s=e.apply(o,r),o=r=null))}null==t&&(t=100);var u=function(){o=this,r=arguments,a=Date.now();var u=n&&!i;return i||(i=setTimeout(l,t)),u&&(s=e.apply(o,r),o=r=null),s};return u.clear=function(){i&&(clearTimeout(i),i=null)},u.flush=function(){i&&(s=e.apply(o,r),o=r=null,clearTimeout(i),i=null)},u}n.debounce=n,e.exports=n},function(e,t){var n=/^(attrs|props|on|nativeOn|class|style|hook)$/;function i(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}}e.exports=function(e){return e.reduce(function(e,t){var r,o,a,s,l;for(a in t)if(r=e[a],o=t[a],r&&n.test(a))if("class"===a&&("string"==typeof r&&(l=r,e[a]=r={},r[l]=!0),"string"==typeof o&&(l=o,t[a]=o={},o[l]=!0)),"on"===a||"nativeOn"===a||"hook"===a)for(s in o)r[s]=i(r[s],o[s]);else if(Array.isArray(r))e[a]=r.concat(o);else if(Array.isArray(o))e[a]=[r].concat(o);else for(s in o)r[s]=o[s];else e[a]=t[a];return e},{})}},function(e,t,n){var i;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var a=r.apply(null,i);a&&e.push(a)}else if("object"===o)for(var s in i)n.call(i,s)&&i[s]&&e.push(s)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)}()},function(e,t,n){"use strict";
/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i=n(1);n.n(i).a},function(e,t,n){"use strict";var i=n(2);n.n(i).a},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var i,r=n(0),o=n.n(r);function a(){if(void 0!==i)return i;var e=document.createElement("div");e.className="scrollbar__wrap",e.style.visibility="hidden",e.style.width="100px",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;return e.parentNode.removeChild(e),i=t-r}function s(e){var t=parseFloat(e);return Number.isNaN(t)?0:t}var l=n(3),u=n.n(l);function c(e,t,n){return u()(e,t,n)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return e>t?1:e===t?0:-1}var p=function(e){if(!e||!e.options||!e.row)return"";var t=e.options,n=e.row,i=t.prop;return i?c(n,i):""},b=function(e){return function(t){return e(t)}},v=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach(function(t){f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},{width:null,label:"",sortable:!1,comparator:h,prop:"",fixed:!1},{},t);if(!n.label)throw new Error("[TableColumnItem]: Column中必须包含唯一的label字段");n.render?this.columnRender=b(n.render):this.columnRender=b(p),this.width=s(n.width),this.hasWidth=!!this.width,this.label=n.label,this.sortable=n.sortable,this.comparator=n.comparator,this.prop=n.prop,this.fixed=!0===n.fixed?"left":n.fixed},m={name:"InfiniteTableColumn",inject:["tableStore"],props:{sortable:{type:Boolean,default:!1},comparator:{type:Function,default:null},width:{type:[Number,String],default:0},label:{type:String,required:!0},prop:{type:String,default:""},fixed:{type:[String,Boolean],default:!1}},data:function(){return{columnWidth:this.width}},watch:{width:function(){var e=this.generateColumnOption();this.tableStore.tableColumns.replaceTableColumn(this.column,e),this.column=e}},mounted:function(){this.column=this.generateColumnOption(),this.tableColumnIndex=this.getColumnIndex(),this.tableStore.tableColumns.addTableColumn(this.column,this.tableColumnIndex)},beforeDestroy:function(){this.tableStore.tableColumns.removeTableColumn(this.column)},methods:{getColumnIndex:function(){return[].indexOf.call(this.$parent.$refs.columnsDef.children,this.$el)},generateColumnOption:function(){var e=this.width,t=this.label,n=this.sortable,i=this.comparator,r=this.prop,o=this.fixed,a=this.$scopedSlots.default;if(!a&&!r)throw new Error("[table-column]: prop和slot-scope必须存在一个");return new v({width:e,label:t,sortable:n,comparator:i,prop:r,render:a,fixed:o})}},render:function(e){return e("div")}},y=n(4),g=n(5),w="headerColumnIndex".toLowerCase(),x={name:"TableHeader",inject:["tableStore","tableOptions","emitter"],props:{headerHeight:{type:Number,required:!0}},data:function(){return{mouseEnterIndex:-1,resizeIndicator:{activeIndex:-1,startX:0,hover:!1,visible:!1,left:-9999}}},computed:{tableColumns:function(){return this.tableStore.tableColumns},sortedColumn:function(){return this.tableStore.dataStore.sortedOption}},beforeDestroy:function(){document.body.style.cursor="initial"},methods:{getTableCellClass:function(e,t){var n=this.resizeIndicator,i=this.mouseEnterIndex,r=i===t||i-1===t;return{"infinite-table__cell--fixed":e.fixed,"infinite-table__cell--pointer":e.sortable&&!n.hover,"infinite-table__cell--resizeable":n.hover&&r,hover:!n.visible&&r}},handleMouseEnter:function(e){this.mouseEnterIndex=e},handleMouseLeave:function(){this.mouseEnterIndex=-1},handleMouseDown:function(e,t){this.tableOptions.headerResizable&&this.resizeIndicator.hover&&(this.resizeIndicator.visible=!0,this.resizeIndicator.left=this.getParentScrollLeft()+t.clientX,this.resizeIndicator.startX=t.clientX,document.body.addEventListener("mousemove",this.handleResizeIndicatorMove),document.body.addEventListener("mouseup",this.handleResizeIndicatorMouseUp),document.body.addEventListener("click",this.stopPropagationClickEvent,!0))},stopPropagationClickEvent:function(e){e.stopPropagation(),e.stopImmediatePropagation()},handleResizeIndicatorMouseUp:function(e){var t=this;if(this.tableOptions.headerResizable){if(this.resizeIndicator.visible){var n=this.resizeIndicator,i=n.activeIndex,r=n.startX,o=e.clientX,a=this.tableStore.tableColumns.columns[i];this.emitter.dispatch("column-resize",i,a,o-r)}this.resizeIndicator.visible=!1,document.body.removeEventListener("mousemove",this.handleResizeIndicatorMove),document.body.removeEventListener("mousemove",this.handleResizeIndicatorMouseUp),setTimeout(function(){document.body.removeEventListener("click",t.stopPropagationClickEvent,!0)})}},getParentScrollLeft:function(){var e=this.$parent.$refs.scrollElement;return e?e.scrollLeft:0},handleMouseMove:function(e,t){if(this.tableOptions.headerResizable&&!this.resizeIndicator.visible){var n=t.currentTarget,i=t.pageX,r=n.getBoundingClientRect();if(r.right-i<8||i-r.left<8&&e>0){n.draggable=!1,this.resizeIndicator.hover=!0;var o=r.right-i<8?this.mouseEnterIndex:this.mouseEnterIndex-1;this.resizeIndicator.activeIndex=o}else n.draggable=!0,this.resizeIndicator.hover=!1}},handleResizeIndicatorMove:function(e){this.resizeIndicator.left=this.getParentScrollLeft()+e.clientX},handleHeaderDragStart:function(e,t){t.dataTransfer.setData(w,e)},handleHeaderDragOver:function(e,t){-1!==[].indexOf.call(t.dataTransfer.types,w)&&t.preventDefault()},handleHeaderDragEnd:function(){},handleHeaderDrop:function(e,t){var n=parseInt(t.dataTransfer.getData(w),10);if("number"==typeof n&&n>=0){var i=this.tableColumns.columns[n],r=this.tableColumns.columns[e];this.emitter.dispatch("header-drop",n,i,e,r)}},getFixedStyle:function(e){return this.tableStore.tableColumns.getFixedColumnStyle(e)},getActiveClass:function(e,t){return!!this.sortedColumn.column&&(this.tableStore.isSameColumn(e,this.sortedColumn.column)&&this.sortedColumn.order===t)},handleColumnSort:function(e,t){e.sortable&&(this.tableStore.dataStore.sortedOption={column:e,order:t})}}};n(10);function _(e,t,n,i,r,o,a,s){var l,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),o&&(u._scopeId="data-v-"+o),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=l):r&&(l=s?function(){r.call(this,this.$root.$options.shadowRoot)}:r),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(e,t){return l.call(t),c(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:u}}var O=_(x,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"infinite-table__table-header",style:{height:e.headerHeight+"px"}},[e._l(e.tableColumns.columns,function(t,i){return n("div",{key:t.label,staticClass:"infinite-table__cell",class:Object.assign({},e.getTableCellClass(t,i)),style:Object.assign({},{width:t.width+"px"},e.getFixedStyle(t)),attrs:{draggable:e.tableOptions.headerOrderDraggable},on:{click:function(n){return e.handleColumnSort(t)},mouseenter:function(t){return e.handleMouseEnter(i,t)},mouseleave:function(t){return e.handleMouseLeave(i,t)},mousemove:function(t){return e.handleMouseMove(i,t)},"!mousedown":function(t){return e.handleMouseDown(i,t)},dragstart:function(t){return e.handleHeaderDragStart(i,t)},dragover:function(t){return e.handleHeaderDragOver(i,t)},dragend:function(t){return e.handleHeaderDragEnd(i,t)},drop:function(t){return e.handleHeaderDrop(i,t)}}},[n("div",{staticClass:"cell-content"},[e._v("\n      "+e._s(t.label)+"\n      "),t.sortable?n("div",{staticClass:"infinite-table__table-header__sortable"},[n("div",{staticClass:"infinite-table__sortable ascending",class:{active:e.getActiveClass(t,"asc")},on:{click:function(n){return n.stopPropagation(),e.handleColumnSort(t,"asc")}}}),e._v(" "),n("div",{staticClass:"infinite-table__sortable descending",class:{active:e.getActiveClass(t,"desc")},on:{click:function(n){return n.stopPropagation(),e.handleColumnSort(t,"desc")}}})]):e._e()])])}),e._v(" "),e.resizeIndicator.visible?n("div",{ref:"resizeIndicator",staticClass:"infinite-table__resize-indicator",style:{left:e.resizeIndicator.left+"px"}}):e._e()],2)},[],!1,null,null,null).exports,C=n(6),S=n.n(C),E=n(7),j=n.n(E);function z(e,t,n,i){var r={index:Math.floor(e/t),offset:e%t},o=function(e,t,n,i){if(0===t||0===i)return e;var r=e.index,o=t+e.offset,a=0,s=r+Math.floor(o/n);return s<0?(s=0,a=0):s>=i?(s=i-1,a=0):a=o>=0?o%n:n+o%n,{index:s,offset:a}}(r,n,t,i);return{startIndex:r.index,endIndex:o.index}}var D={name:"RangeRender",props:{data:{type:[Array,Object],required:!0},direction:{type:String,default:"vertical"},offset:{type:Number,required:!0},viewportSize:{type:Number,required:!0},dataKey:{type:String,required:!0},size:{type:Number,default:null},sizeField:{type:String,default:null},leadingSize:{type:Number,default:0},trailSize:{type:Number,default:0}},data:function(){return{pool:[]}},computed:{accumulationOffset:function(){var e=this;if(this.sizeField){var t=0;return this.data.map(function(n,i,r){if(0===i)return 0;var o=c(r[i-1],e.sizeField),a=t+o;return t+=o,a})}return[]},componentProps:function(){return{data:this.data,offset:this.offset,viewportSize:this.viewportSize,size:this.size,sizeField:this.sizeField,leadingSize:this.leadingSize,trailSize:this.trailSize,direction:this.direction}}},watch:{componentProps:{immediate:!0,handler:function(){this.handleIndexChange()}}},beforeCreate:function(){this.viewId=0,this.cacheViewList=[],this.activeViewMap=new Map},methods:{addToPool:function(e,t,n){var i={id:this.viewId,active:!0,index:t,key:n};this.viewId+=1,Object.defineProperty(e,"props",{enumerable:!1,configurable:!1,writable:!1,value:i}),this.pool.push(e)},invalidViewItem:function(e){this.activeViewMap.delete(e.props.key),this.cacheViewList.push(e),e.position=-99999,e.props.active=!1},handleIndexChange:function(){var e,t,n=this.offset,i=this.viewportSize,r=this.dataKey,o=this.data,a=this.size;if(this.sizeField){var s=function(e,t,n){for(var i,r=-1,o=0;o<e.length;o+=1){var a=e[o];if(o<e.length-1){var s=e[o+1];if(t>=a&&t<s&&(r=o),-1!==r&&t+n>=a&&t+n<s){i=o;break}}else-1===r&&(r=o),i=o}return{startIndex:r,endIndex:i}}(this.accumulationOffset,n,i);e=s.startIndex,t=s.endIndex+1}else{var l=z(n,a,i,o.length);e=l.startIndex,t=l.endIndex+1}e=Math.max(0,e-this.leadingSize),t=Math.min(o.length,t+this.trailSize);for(var u=0;u<this.pool.length;u+=1){var d=this.pool[u],f=this.data[d.props.index];(d.props.index<e||d.props.index>=t||d.data!==f)&&d.props.active&&this.invalidViewItem(d)}for(var h=e;h<t;h+=1){var p=this.data[h],b=c(p,r),v=this.activeViewMap.get(b);v||((v=this.cacheViewList.pop())?(v.data=p,v.props.key=b,v.props.index=h,v.props.active=!0):(v={data:p,position:0},this.addToPool(v,h,b)),this.activeViewMap.set(v.props.key,v)),v.position=a?this.size*h:this.accumulationOffset[h]}}}},I=(n(11),_(D,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"range-render"},e._l(e.pool,function(t){return n("div",{key:t.props.id,staticClass:"range-render__item",style:{transform:"translate"+("vertical"===e.direction?"Y":"X")+"("+t.position+"px)"}},[e._t("default",null,{data:t.data,index:t.props.index})],2)}),0)},[],!1,null,null,null).exports);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach(function(t){R(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach(function(t){A(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=_({name:"TableBody",inject:["tableStore","tableOptions"],components:{RangeRender:I,TableRow:{name:"TableRow",inject:["tableStore","emitter","tableOptions"],components:{RangeRender:I},props:{index:{type:Number,required:!0},data:{type:Object,required:!0},offsetX:{type:Number,default:0}},methods:{getFixedStyle:function(e){return this.tableStore.tableColumns.getFixedColumnStyle(e)},dispatchRowEvent:function(e,t,n,i){this.emitter.dispatch(e,t,n,i)},renderTableCell:function(e){var t=this,n=this.$createElement,i=this.data,r=this.tableStore,o=this.index,a=r.tableSelection,s=a.focusedRow,l=a.selectedColumn,u=this.tableOptions,c=u.highlightCurrentCell,d=u.rowDraggable,f=u.rowHeight,h=e.data,p=h.columnRender,b=c&&r.isSameColumn(l,h)&&r.isSameRow(i,s),v=j()("infinite-table__cell","infinite-table__cell--ellipsis",{"infinite-table__cell--selected":b,"infinite-table__cell--fixed":!!h.fixed,"fixed-left":"left"===h.fixed,"fixed-right":"right"===h.fixed});return n("div",S()([{class:v,attrs:{draggable:d},style:T({width:"".concat(h.width,"px"),height:"".concat(f,"px")},this.getFixedStyle(h))},{on:{click:function(e){t.dispatchRowEvent("cell-click",i,h,e),t.dispatchRowEvent("row-click",i,h,e)},contextmenu:function(e){return t.dispatchRowEvent("row-contextmenu",i,h,e)},dblclick:function(e){return t.dispatchRowEvent("row-dblclick",i,h,e)},dragstart:function(e){return t.dispatchRowEvent("row-dragstart",i,h,e)},dragend:function(e){return t.dispatchRowEvent("row-dragend",i,h,e)},dragover:function(e){return t.dispatchRowEvent("row-dragover",i,h,e)},drop:function(e){return t.dispatchRowEvent("row-drop",i,h,e)}}}]),[n("div",{class:"cell-content"},[p({row:i,options:h,rowIndex:o})])])}},render:function(e){var t=this,n=this.tableStore.layoutSize,i=this.tableStore.tableColumns,r=i.leftFixedColumns,o=i.rightFixedColumns,a=i.mainColumns,s=i.leftFixedColumnWidth,l=i.rightFixedColumnWidth,u=this.offsetX,c=this.tableOptions;return e("div",{class:"infinite-table__row",style:{width:"".concat(n.allColumnsWidth,"px"),height:"".concat(c.rowHeight,"px")}},[r.map(function(e){return t.renderTableCell({data:e})}),e("range-render",{style:{width:"".concat(n.allColumnsWidth,"px")},props:{dataKey:"label",data:a,direction:"horizontal",sizeField:"width",offset:u,viewportSize:n.viewportWidth-s-l},scopedSlots:{default:this.renderTableCell}}),o.map(function(e){return t.renderTableCell({data:e})})])}}},data:function(){return{grid:{offsetX:0,offsetY:0}}},computed:{data:function(){return this.tableStore.dataStore.data},fixedData:function(){return this.tableStore.dataStore.fixedData},layoutSize:function(){return this.tableStore.layoutSize},tableBodyListeners:function(){return F({},this.$listeners)}},watch:{data:function(){this.handleScroll()}},beforeCreate:function(){this.handing=!1},mounted:function(){this.scroll=this.getScrollElement(),this.scroll.addEventListener("scroll",this.handleScroll),this.handleScroll()},methods:{getExtraRowAttrs:function(e,t){var n=this.tableOptions,i=n.striped,r=n.rowExtraAttrs,o=this.tableStore.tableSelection,a=r;return"function"==typeof r&&(a=r(e,t)),F({style:F({},a.style),class:F({},a.class,{"infinite-table__row--striped":i&&t%2==1,"infinite-table__row--selected":o.hasSelected(e)})},a.attrs)},handleScroll:function(){var e=this;this.handing||(this.handing=!0,requestAnimationFrame(function(){e.changeOffsetIndex(),e.handing=!1}))},changeOffsetIndex:function(){var e=this.scroll,t=e.scrollTop,n=e.scrollLeft;this.grid.offsetX=n,this.grid.offsetY=t},getScrollElement:function(){return this.$el.closest(".infinite-table--scrollable")}}},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",e._g({staticClass:"infinite-table__body",style:{height:e.layoutSize.viewportHeight+"px","transform-style":e.fixedData.length>=0?"preserve-3d":"initial"}},e.tableBodyListeners),[n("div",{staticStyle:{position:"relative"},style:{height:e.fixedData.length*e.tableOptions.rowHeight+"px",transform:"translate3d(0px, "+e.grid.offsetY+"px, 1px)"}},e._l(e.fixedData,function(t,i){return n("table-row",e._b({key:i,style:{position:"relative"},attrs:{index:i,"offset-x":e.grid.offsetX,data:t}},"table-row",e.getExtraRowAttrs(e.data,i),!1))}),1),e._v(" "),n("range-render",{attrs:{data:e.data,direction:"vertical",size:e.tableOptions.rowHeight,"data-key":e.tableOptions.rowKey,"viewport-size":e.layoutSize.viewportHeight-e.fixedData.length*e.tableOptions.rowHeight,offset:e.grid.offsetY,"trail-size":1,"leading-size":1},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data,r=t.index;return[n("table-row",e._b({attrs:{index:r+e.fixedData.length,"offset-x":e.grid.offsetX,data:i}},"table-row",e.getExtraRowAttrs(i,r+e.fixedData.length),!1))]}}])}),e._v(" "),n("div",{staticStyle:{position:"absolute",height:"1px"},style:{transform:"translateY("+e.data.length*e.tableOptions.rowHeight+"px)",width:e.layoutSize.allColumnsWidth+"px"}})],1)},[],!1,null,null,null).exports;function H(e,t){return null!=e&&e.length?function(e,t){var n,i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=t(a.value);void 0!==l&&(n=void 0===n?l:n+l)}}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t):0}function K(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new o.a({data:{allTableColumns:[]},computed:{leftFixedColumns:function(){return this.allTableColumns.filter(function(e){return"left"===e.fixed})},rightFixedColumns:function(){return this.allTableColumns.filter(function(e){return"right"===e.fixed})},leftFixedColumnWidth:function(){return H(this.leftFixedColumns,function(e){return e.width})},rightFixedColumnWidth:function(){return H(this.rightFixedColumns,function(e){return e.width})},mainColumns:function(){return this.allTableColumns.filter(function(e){return!e.fixed})},columns:function(){return[].concat(K(this.leftFixedColumns),K(this.mainColumns),K(this.rightFixedColumns))},columnOffset:function(){var e=this,t=0;return this.columns.map(function(n,i){return 0===i?0:t+=e.columns[i-1].width||0})},fixedPositionMap:function(){for(var e={left:new Map,right:new Map},t=0;t<this.leftFixedColumns.length;t+=1)if(0===t)e.left.set(t,0);else{var n=e.left.get(t-1),i=this.leftFixedColumns[t-1];e.left.set(t,n+i.width)}for(var r=this.rightFixedColumns.length-1;r>=0;r-=1)if(r===this.rightFixedColumns.length-1)e.right.set(r,0);else{var o=e.right.get(r+1),a=this.rightFixedColumns[r+1];e.right.set(r,o+a.width)}return e}},methods:{getColumnsByFixed:function(e){switch(e){case"left":return this.leftFixedColumns;case"right":return this.rightFixedColumns;default:return this.mainColumns}},findColumnIndex:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?this.allTableColumns.findIndex(function(t){return e.label===t.label}):this.columns.findIndex(function(t){return e.label===t.label})}}});this._vm=t}var t,n,i;return t=e,(n=[{key:"getColumnOffset",value:function(e){var t=this._vm.findColumnIndex(e);return this._vm.columnOffset[t]}},{key:"getFixedColumnStyle",value:function(e){if(e.fixed){var t=this._vm.getColumnsByFixed(e.fixed).findIndex(function(t){return t.label===e.label}),n=this._vm.fixedPositionMap;return i={},r=e.fixed,o="".concat(n[e.fixed].get(t),"px"),r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}var i,r,o;return{}}},{key:"addTableColumn",value:function(e,t){var n=this._vm.allTableColumns;"number"==typeof t?n.splice(t,0,e):n.push(e)}},{key:"removeTableColumn",value:function(e){var t=this._vm.findColumnIndex(e,!0);-1!==t&&this._vm.allTableColumns.splice(t,1)}},{key:"replaceTableColumn",value:function(e,t){var n=this._vm.findColumnIndex(e,!0);-1!==n&&this._vm.allTableColumns.splice(n,1,t)}},{key:"clear",value:function(){this._vm.allTableColumns=[]}},{key:"columns",get:function(){return this._vm.columns}},{key:"leftFixedColumns",get:function(){return this._vm.leftFixedColumns}},{key:"rightFixedColumns",get:function(){return this._vm.rightFixedColumns}},{key:"leftFixedColumnWidth",get:function(){return this._vm.leftFixedColumnWidth}},{key:"rightFixedColumnWidth",get:function(){return this._vm.rightFixedColumnWidth}},{key:"mainColumns",get:function(){return this._vm.mainColumns}}])&&L(t.prototype,n),i&&L(t,i),e}();function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var N=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.rowKey;if(!n)throw new Error("[TableSelectionStore]: rowKey必须存在");this.rowKey=n,this.selectedRows=[],this.focusedRow={},this.selectedColumn={},this.selectedCell={row:{},column:{}}}var t,n,i;return t=e,(n=[{key:"clearSelectedRows",value:function(){this.selectedRows=[]}},{key:"addSelectedRows",value:function(e,t){var n=this.findSelectionIndex(e),i=this.selectedRows.length;t||this.clearSelectedRows(),t&&-1!==n||!t&&i>1?this.selectedRows.splice(n,1):this.selectedRows.push(e)}},{key:"findSelectionIndex",value:function(e){var t=this;return this.selectedRows.findIndex(function(n){return n[t.rowKey]===e[t.rowKey]})}},{key:"hasSelected",value:function(e){return this.findSelectionIndex(e)>=0}}])&&$(t.prototype,n),i&&$(t,i),e}();function B(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function V(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function q(e){return new o.a({data:{dataKey:e.dataKey,freeze:e.freeze||!1,data:[],fixedKeys:[],sortedOption:{}},computed:{fixedData:function(){var e=this,t=new Set(this.fixedKeys);return this.data.filter(function(n){return t.has(c(n,e.dataKey))})},normalData:function(){var e=this,t=new Set(this.fixedKeys),n=this.data.filter(function(n){return!t.has(c(n,e.dataKey))});return this.compareDataItem(n)},allData:function(){return[].concat(V(this.fixedData),V(this.normalData))}},methods:{compareDataItem:function(e){var t=this.sortedOption,n=t.column,i=t.order;if(!i||!n||"nature"===i)return e;var r=n.comparator,o=n.prop;return e.sort(function(e,t){var n="desc"===i?-1:1;return r.call(null,c(e,o),c(t,o))*n})},setData:function(e){this.freeze?this.data=e.map(function(e){return Object.freeze(e)}):this.data=e},setSortedOption:function(e){var t,n,i=this.sortedOption,r=i.column,o=i.order,a=e.column,s=e.order;if(s||(n=r,(t=a)&&n&&t.label&&n.label&&t.label===n.label)){if(!s)switch(o){case"asc":s="desc";break;case"desc":s="nature";break;default:s="asc"}}else s="asc";this.sortedOption={order:s,column:a}}}})}var X=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"_vm",{value:q(t),enumerable:!1,writable:!1,configurable:!1})}var t,n,i;return t=e,(n=[{key:"updateData",value:function(e){this._vm.setData(e)}},{key:"updateFixedKeys",value:function(e){this._vm.fixedKeys=e}},{key:"data",get:function(){return this._vm.normalData}},{key:"fixedData",get:function(){return this._vm.fixedData}},{key:"allData",get:function(){return this._vm.allData}},{key:"sortedOption",set:function(e){this._vm.setSortedOption(e)},get:function(){return this._vm.sortedOption}}])&&B(t.prototype,n),i&&B(t,i),e}();function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.context=t.context;var n=this.context.rowKey;this.eventEmitter=t.eventEmitter,this.rowHeight=t.rowHeight,this.__layoutSize=t.layoutSize,this.tableSelection=new N({rowKey:this.context.rowKey}),this.tableColumns=new W,this.dataStore=new X({dataKey:n}),this.dataStore.updateData(t.data),this.dataStore.updateFixedKeys(t.fixedKeys)}var t,n,i;return t=e,(n=[{key:"isSameRow",value:function(e,t){var n=this.context.rowKey;return c(e,n)===c(t,n)}},{key:"isSameColumn",value:function(e,t){return e.label===t.label}},{key:"layoutSize",get:function(){return this.__layoutSize},set:function(e){this.__layoutSize=e}}])&&U(t.prototype,n),i&&U(t,i),e}();function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e,t){var n=0,i=e,r=t.reduce(function(e,t){var r=t.width;return t.hasWidth?i-=t.width:(n+=1,r=80),e+r},0),o=0;return t.map(function(t){var a,s,l,u=t.hasWidth,c=t.width;return u||(r<=e?(a=i,s=n,l=o,c=Math.floor(a/s)+(l<a%s?1:0),o+=1):c=80),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(n,!0).forEach(function(t){J(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{width:c})})}function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ee=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vm=t}var t,n,i;return t=e,(n=[{key:"dispatch",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.vm.$emit.apply(this.vm,[e].concat(n))}}])&&Z(t.prototype,n),i&&Z(t,i),e}();n(12);function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ie="UP",re="DOWN",oe=_({name:"InfiniteTable",components:{TableBody:M,TableHeader:O},props:{data:{type:Array,default:function(){return[]}},height:{type:[Number,String],default:"100%"},headerHeight:{type:[Number,String],default:48},rowHeight:{type:[Number,String],default:48},rowKey:{type:String,required:!0},striped:{type:Boolean,default:!0},highlightCurrentRow:{type:Boolean,default:!0},multipleSelection:{type:Boolean,default:!1},highlightCurrentCell:{type:Boolean,default:!1},rowExtraAttrs:{type:[Object,Function],default:function(){return{}}},headerResizable:{type:Boolean,default:!1},headerOrderDraggable:{type:Boolean,default:!1},rowDraggable:{type:Boolean,default:!1},tableColumns:{type:Array,default:function(){return[]}},topFixedKeys:{type:Array,default:function(){return[]}}},data:function(){return{composeKey:{shift:!1,control:!1},tableStore:new Y({context:this,data:this.data,fixedKeys:this.topFixedKeys,layoutSize:{viewportWidth:0,viewportHeight:0,allColumnsWidth:0}})}},computed:{tableOptions:function(){return{rowExtraAttrs:this.rowExtraAttrs,headerHeight:s(this.headerHeight),striped:this.striped,rowKey:this.rowKey,rowHeight:s(this.rowHeight),headerResizable:this.headerResizable,rowDraggable:this.rowDraggable,headerOrderDraggable:this.headerOrderDraggable,highlightCurrentCell:this.highlightCurrentCell,multipleSelection:this.multipleSelection}},tableHeight:function(){var e,t;return e=this.height?this.height:this.data.length>0?this.tableOptions.rowHeight*this.data.length+this.headerHeight:250,"number"!=typeof(t=e)||Number.isNaN(t)?t:"".concat(t,"px")},tableHeaderClass:function(){return{"infinite-table__table-header--sticky":this.tableHeight}}},provide:function(){return{tableStore:this.tableStore,tableOptions:this.tableOptions,emitter:new ee(this)}},watch:{data:{handler:function(e){this.tableStore.dataStore.updateData(e),this.doLayout()}},topFixedKeys:function(e){this.tableStore.dataStore.updateFixedKeys(e)},tableColumns:{immediate:!0,deep:!0,handler:function(){var e=this;this.tableStore.tableColumns.clear(),this.tableColumns.map(function(e){return new v(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(n,!0).forEach(function(t){ne(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e))}).forEach(function(t){e.tableStore.tableColumns.addTableColumn(t)})}},tableOptions:{deep:!0,handler:function(){this.doLayout()}},"tableStore.tableColumns.columns":{handler:function(){var e=this;this.$nextTick(function(){e.doLayout()})}}},created:function(){var e=this;this.doLayout=Object(g.debounce)(this.doLayout,100),this.$on("row-click",function(t){e.selectRow(t)}),this.$on("cell-click",function(t,n){e.tableStore.tableSelection.selectedColumn=n})},mounted:function(){var e=this;this.resizeObserver=new y.a(function(){e.doLayout()}),this.resizeObserver.observe(this.$refs.table),this.doLayout()},beforeDestroy:function(){this.resizeObserver.disconnect()},methods:{doLayout:function(){var e,t,n=this,i=function(e){if(e instanceof HTMLElement){var t=e.getBoundingClientRect(),n=t.width;return{height:t.height,width:n}}throw new Error("getClientSize错误: el不是HTMLElement对象")}(this.$el),r=this.tableOptions.headerHeight,o=i.width,l=(e=this.rowHeight,t=this.data.length,e*t);i.height>0&&i.height-r<l&&(o-=a());var u=Q(o,this.tableStore.tableColumns.columns),c=u.reduce(function(e,t){return e+t.width},0),d=c>o,f=i.height-r;d&&(f-=a()),c!==this.lastAllColumnsWidth&&(this.tableStore.tableColumns.clear(),u.forEach(function(e){n.tableStore.tableColumns.addTableColumn(e)})),this.lastAllColumnsWidth=c,this.tableStore.layoutSize={rowHeight:s(this.rowHeight),viewportWidth:o,viewportHeight:f,allColumnsWidth:c}},selectRow:function(e){var t=this.tableStore.tableSelection;t.focusedRow=e;var n=this.composeKey.control&&this.tableOptions.multipleSelection;t.addSelectedRows(e,n),this.$emit("current-change",t.selectedRows)},handleChangeSelect:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie;if(t===re){var n=/Arrow(Up|Down|Left|Right)/i.exec(e.key);if(n){var i=n[1].toLowerCase();this.move(i)}}},handleComposeKeyEvent:function(e,t){this.$set(this.composeKey,e.key.toLowerCase(),t===re)},handleDispatchKeyEvent:function(e,t){var n=this.tableStore.tableSelection,i=n.focusedRow,r=n.selectedColumn;this.$emit("key-".concat(t.toLowerCase()),i,r,e)},handleKeyEvent:function(e,t){for(var n=e.key,i=[{rule:/^Arrow(Down|Up|Left|Right)/i,method:this.handleChangeSelect},{rule:/(Control|Shift)/i,method:this.handleComposeKeyEvent},{rule:/(.*)/i,method:this.handleDispatchKeyEvent}],r=0;r<i.length;r+=1){var o=i[r];if(o.rule.test(n)){o.method.call(this,e,t);break}}},tryScrollInvisibleElem:function(e,t,n,i){var r=this.tableOptions.rowHeight,o=this.$refs.scrollElement,a=o.scrollTop,s=o.scrollLeft,l=this.tableStore.layoutSize,u=l.viewportWidth,c=l.viewportHeight,d=this.tableStore.dataStore,f=d.allData,h=d.fixedData,p=e*r<a+h.length*r;e>=h.length&&(p||(e+1)*r>a+c)&&this.scrollToRow(f[e],p?"top":"bottom");var b=this.tableStore.tableColumns,v=b.columns[t];if(!1===v.fixed){var m=b.getColumnOffset(v),y=b.leftFixedColumnWidth,g=b.rightFixedColumnWidth,w=s+y>m;(w||s+u-g<m+v.width)&&this.scrollToColumn(v,w?"left":"right")}},move:function(e){var t,n=this.tableStore.tableColumns.columns,i=this.tableStore.tableSelection,r=i.focusedRow,o=i.selectedColumn,a=this.tableStore.dataStore.allData,s=a.indexOf(r),l=n.findIndex(function(e){return e.label===o.label});switch(-1===s&&(s=0),-1===l&&(l=0),e){case"up":s=0===s?0:s-1,this.tryScrollInvisibleElem(s,l,"top","left"),t=a[s],this.selectRow(t);break;case"down":s=s===a.length-1?a.length-1:s+1,this.tryScrollInvisibleElem(s,l,"bottom","left"),t=a[s],this.selectRow(t);break;case"left":l=0===l?0:l-1,this.tableStore.tableSelection.selectedColumn=n[l],this.tryScrollInvisibleElem(s,l,"top","left");break;case"right":l===n.length-1?l=n.length-1:l+=1,this.tableStore.tableSelection.selectedColumn=n[l],this.tryScrollInvisibleElem(s,l,"top","right")}},focus:function(){this.$refs.table.focus()},scrollToColumn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",n=this.tableStore,i=n.layoutSize,r=n.tableColumns,o=r.getColumnOffset(e);if(o>=0){var a=0;"middle"===t?a=-1*(i.viewportWidth/2-e.width):"right"===t&&(a=-1*(i.viewportWidth-e.width));var s=0;"left"===t&&"left"!==e.fixed?s=r.leftFixedColumnWidth:"right"===t&&"right"!==e.fixed&&(s=-1*r.rightFixedColumnWidth),this.$refs.scrollElement.scrollLeft=o+a-s}},scrollToRow:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",i=this.tableOptions.rowHeight,r=this.tableStore,o=r.dataStore,a=r.layoutSize,s=o.allData,l=o.fixedData,u=c(e,this.rowKey),d=s.findIndex(function(e){return c(e,t.rowKey)===u});if(-1!==d){var f=0;"top"===n?f=-1*l.length*i:"middle"===n?f=-1*(a.viewportHeight/2-i):"bottom"===n&&(f=-1*(a.viewportHeight-i));var h=i*d;this.$refs.scrollElement.scrollTo(this.$refs.scrollElement.scrollLeft,h+f)}}}},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"table",staticClass:"infinite-table",style:{height:e.tableHeight},attrs:{tabindex:"0"},on:{keydown:function(t){return e.handleKeyEvent(t,"DOWN")},keyup:function(t){return e.handleKeyEvent(t,"UP")},"!click":function(t){return e.focus(t)}}},[0===e.tableColumns.length?n("div",{ref:"columnsDef",staticClass:"infinite-table__columns-define"},[e._t("default")],2):e._e(),e._v(" "),n("div",{ref:"scrollElement",staticClass:"infinite-table--scrollable"},[n("table-header",{class:e.tableHeaderClass,style:{width:e.tableStore.layoutSize.allColumnsWidth+"px"},attrs:{"header-height":e.tableOptions.headerHeight}}),e._v(" "),n("table-body")],1)])},[],!1,null,null,null).exports;t.default={InfiniteTable:oe,InfiniteTableColumn:m,install:function(){o.a.component("infinite-table-column",m),o.a.component("infinite-table",oe)}}}]).default});
//# sourceMappingURL=infinite-table.js.map